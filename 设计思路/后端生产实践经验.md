# 后端生产实践经验

by HyperQing 2017-12-05 禁止转载，违规发表追究责任

>本文内容源于生产实践，即使如此，也仅仅在是当时实践场景下得到的经验。不代表今后不会发生改变。随着时间推移和技术的发展，若本文有过时落后或不足之处，还请不吝指正。

[TOC]

## 数据库设计利器：Migration与Seeder

### 术语解释

**Migration**：数据库迁移工具。即使用编程语言书写伪SQL语句表达SQL操作，以此完成数据库迁移操作。例如有以下语句：
```
$table->text('article_content')->comment('文章内容');
```
表示，声明该数据表有一个`article_content`字段，类型为`text`。

**Seeder**：数据库填充工具。使用该工具可以向数据库填充预先设置的或随机生成的数据。

### 如何得到

独立的 PHP Migration 工具

- Phinx: https://phinx.org/

以下 PHP 框架有相关工具
- Laravel 5.x （同时有Migration 与 Seeder）
- ThinkPHP 5.0.x （同时有Migration 与 Seeder）
- Yii 2.0（仅有 Migration 工具）

### 实践经验

后端框架**必须有 Migration 数据库迁移和 Seeder 数据填充功能。**

因为可以非常简单地通过命令行**随时刷新数据表结构和数据集**。

开发者只需要修改Migration或Seeder后，执行命令，立即得到最新的预先设计好的数据库。

尤其是在这样的场合中，发挥巨大作用

- 系统设计初期，数据表结构频繁更改，。
- 实现多表写入或更新操作时，各数据表可能因出错导致数据不一致，需要随时重置测试数据。
- 对于某些强烈依赖数据库数据的产品，从开发到上线都要有可靠的数据集。例如：某程序运行顺序、执行方式、响应方式等完全由数据决定的，这必须确保100%数据可靠


综上：极大提升数据库设计、修改、测试效率。由于每次测试都能重新填充数据，数据库设计质量非常好。可以理解为一个精巧的数据库版本管理工具。

## 使用Laravel注意事项

设置中国时区：修改`config/app.php`文件的`timezone`为`PRC`。

## ThinkPHP 5 与 Laravel 5 的比较

### 适用场景

**Laravel**: **系统化工程**、优雅、强调质量、工具链发达、有**前端工程**需求的场景。例如：自营产品、内部系统、面向接口开发等。

**ThinkPHP**：**高性能**、实用、丰富的代码提示和中文注释、**极速开发应用**、多快好省，工具链要求不高的场景。例如：**外包工程**、自营产品、内部系统、面向接口开发等。

### 哲学

**Laravel**

哲学：系统化工程，事无巨细，样样都要关注。强调优雅、样样都要写诗一样。框架架构高度封装和抽象，需要充分了解功能特性才能发挥框架能力。

例如，当你安装完成，编写控制器业务，你还需要手动添加路由规则才能访问你的控制器方法。

**ThinkPHP**

哲学：全自动，全部精力关注业务开发。强调开发速度，能自动都自动。框架架构容易理解、介入、甚至改动。

例如，当你安装完成后，编写控制器业务即可运行。

### 路由

**Laravel**

没有自动路由，即使是首页都要添加路由规则。

**ThinkPHP**

拥有自动路由功能，可以直接通过`模块/控制器/方法`这样的三段式路径来访问控制器方法。

### 数据库操作

**Laravel**
- 模型类需要手动声明数据表名和主键名。
- 使用`DB`类时，无法使用模型名自动推断表名。
- 没有虚拟视图查询功能，只有`join`关联查询。

**ThinkPHP**
- 模型类可自动推断数据表名，自动获取表结构信息，也支持缓存表结构信息以提升性能。
- 使用`DB`类时，可使用模型名自动推断表名。
- 提供虚拟视图查询功能，以书写视图的方式，来完成关联查询，简化关联查询书写。

### 前端开发

**Laravel**

默认支持Vue、React前端工程，提供`package.json`文件便于使用npm进行操作。

**ThinkPHP**

暂未默认支持Vue、React前端工程。需要自行实现或以简单引入js文件代替。

